!function(){function process(){var a=getTransactions(),b=getOfxTemplate();b.OFX.CREDITCARDMSGSRSV1.CCSTMTTRNRS.CCSTMTRS.BANKTRANLIST.STMTTRN=a.transactions,b.OFX.CREDITCARDMSGSRSV1.CCSTMTTRNRS.CCSTMTRS.BANKTRANLIST.DTSTART=a.start.format("yyyymmdd"),b.OFX.CREDITCARDMSGSRSV1.CCSTMTTRNRS.CCSTMTRS.BANKTRANLIST.DTEND=a.end.format("yyyymmdd"),b.OFX.CREDITCARDMSGSRSV1.CCSTMTTRNRS.CCSTMTRS.LEDGERBAL.DTASOF=(new Date).format("yyyymmdd");Number($("p:contains('Current Balance')").parent().find(".cent, .dollarAmt").text().replace(/[^\d.-]/g,""));b.OFX.CREDITCARDMSGSRSV1.CCSTMTTRNRS.CCSTMTRS.LEDGERBAL.BALAMT=BALAMT;var d=new X2JS,e=d.json2xml_str(b),f=getHeader()+e,g=new File([f],"statement.ofx",{type:"text/plain;charset=utf-8"});saveAs(g)}function getHeader(){var a='<?xml version="1.0" encoding="UTF-8"?>\r\n<?OFX OFXHEADER="200" VERSION="220" SECURITY="NONE" OLDFILEUID="NONE" NEWFILEUID="NONE"?>\r\n';return a}function getOfxTemplate(){var a="<OFX><CREDITCARDMSGSRSV1><CCSTMTTRNRS><TRNUID>0</TRNUID><STATUS><CODE>0</CODE><SEVERITY>INFO</SEVERITY></STATUS><CCSTMTRS><CURDEF>USD</CURDEF><CCACCTFROM><ACCTID>999988</ACCTID></CCACCTFROM><BANKTRANLIST><DTSTART></DTSTART><DTEND></DTEND></BANKTRANLIST><LEDGERBAL><BALAMT>0</BALAMT><DTASOF></DTASOF></LEDGERBAL></CCSTMTRS></CCSTMTTRNRS></CREDITCARDMSGSRSV1></OFX>",b=new X2JS;return b.xml_str2json(a)}function getTransactions(){var jsonString=document.getElementById("completedBillingActivityJSONArray").value,transactions=eval(jsonString),start,end,ofxTransactions=[];transactions.forEach(function(a){var b=new Date(a.POST_DATE),c=b.format("yyyymmdd"),d="Amazon - "+cleanDescription(a.TRANS_DESC),e=-parseFloat(a.TRANS_AMOUNT),f=a.REF_NUM?a.REF_NUM:d+c;f=f.trim(),(!start||start>b)&&(start=b),(!end||end<b)&&(end=b),ofxTransactions.push(createTransaction(e,f,d,c))});var parsedTransactions={};return parsedTransactions.start=start,parsedTransactions.end=end,parsedTransactions.transactions=ofxTransactions,parsedTransactions}function cleanDescription(a){return a=a.trim().replace(/ +(?= )/g,"").replace(/<br\/>/gi,"; "),a=a.replace("AMAZON MARKETPLACE SEATTLE WA;",""),a=a.replace("AMAZON RETAIL SEATTLE WA;",""),a=a.replace("SHIPPING AND TAX",""),a=a.replace("AMAZON DIGITAL SEATTLE WA;",""),a=a.trim().replace(/ +(?= )/g,"")}function createTransaction(a,b,c,d){var e={};return e.TRNTYPE=a>=0?"CREDIT":"DEBIT",e.DTPOSTED=d,e.TRNAMT=a,e.FITID=b,e.NAME=c,e}function init(){var a=function(){var b=/d{1,4}|m{1,4}|yy(?:yy)?|([HhMsTt])\1?|[LloSZ]|"[^"]*"|'[^']*'/g,c=/\b(?:[PMCEA][SDP]T|(?:Pacific|Mountain|Central|Eastern|Atlantic) (?:Standard|Daylight|Prevailing) Time|(?:GMT|UTC)(?:[-+]\d{4})?)\b/g,d=/[^-+\dA-Z]/g,e=function(a,b){for(a=String(a),b=b||2;a.length<b;)a="0"+a;return a};return function(f,g,h){var i=a;if(1!=arguments.length||"[object String]"!=Object.prototype.toString.call(f)||/\d/.test(f)||(g=f,f=void 0),f=f?new Date(f):new Date,isNaN(f))throw SyntaxError("invalid date");g=String(i.masks[g]||g||i.masks.default),"UTC:"==g.slice(0,4)&&(g=g.slice(4),h=!0);var j=h?"getUTC":"get",k=f[j+"Date"](),l=f[j+"Day"](),m=f[j+"Month"](),n=f[j+"FullYear"](),o=f[j+"Hours"](),p=f[j+"Minutes"](),q=f[j+"Seconds"](),r=f[j+"Milliseconds"](),s=h?0:f.getTimezoneOffset(),t={d:k,dd:e(k),ddd:i.i18n.dayNames[l],dddd:i.i18n.dayNames[l+7],m:m+1,mm:e(m+1),mmm:i.i18n.monthNames[m],mmmm:i.i18n.monthNames[m+12],yy:String(n).slice(2),yyyy:n,h:o%12||12,hh:e(o%12||12),H:o,HH:e(o),M:p,MM:e(p),s:q,ss:e(q),l:e(r,3),L:e(r>99?Math.round(r/10):r),t:o<12?"a":"p",tt:o<12?"am":"pm",T:o<12?"A":"P",TT:o<12?"AM":"PM",Z:h?"UTC":(String(f).match(c)||[""]).pop().replace(d,""),o:(s>0?"-":"+")+e(100*Math.floor(Math.abs(s)/60)+Math.abs(s)%60,4),S:["th","st","nd","rd"][k%10>3?0:(k%100-k%10!=10)*k%10]};return g.replace(b,function(a){return a in t?t[a]:a.slice(1,a.length-1)})}}();a.masks={default:"ddd mmm dd yyyy HH:MM:ss",shortDate:"m/d/yy",mediumDate:"mmm d, yyyy",longDate:"mmmm d, yyyy",fullDate:"dddd, mmmm d, yyyy",shortTime:"h:MM TT",mediumTime:"h:MM:ss TT",longTime:"h:MM:ss TT Z",isoDate:"yyyy-mm-dd",isoTime:"HH:MM:ss",isoDateTime:"yyyy-mm-dd'T'HH:MM:ss",isoUtcDateTime:"UTC:yyyy-mm-dd'T'HH:MM:ss'Z'"},a.i18n={dayNames:["Sun","Mon","Tue","Wed","Thu","Fri","Sat","Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],monthNames:["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec","January","February","March","April","May","June","July","August","September","October","November","December"]},Date.prototype.format=function(b,c){return a(this,b,c)},saveAs=saveAs||function(a){"use strict";if(!("undefined"==typeof a||"undefined"!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var b=a.document,c=function(){return a.URL||a.webkitURL||a},d=b.createElementNS("http://www.w3.org/1999/xhtml","a"),e="download"in d,f=function(a){var b=new MouseEvent("click");a.dispatchEvent(b)},g=/constructor/i.test(a.HTMLElement),h=/CriOS\/[\d]+/.test(navigator.userAgent),i=function(b){(a.setImmediate||a.setTimeout)(function(){throw b},0)},j="application/octet-stream",k=4e4,l=function(a){var b=function(){"string"==typeof a?c().revokeObjectURL(a):a.remove()};setTimeout(b,k)},m=function(a,b,c){b=[].concat(b);for(var d=b.length;d--;){var e=a["on"+b[d]];if("function"==typeof e)try{e.call(a,c||a)}catch(a){i(a)}}},n=function(a){return/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(a.type)?new Blob([String.fromCharCode(65279),a],{type:a.type}):a},o=function(b,i,k){k||(b=n(b));var r,o=this,p=b.type,q=p===j,s=function(){m(o,"writestart progress write writeend".split(" "))},t=function(){if((h||q&&g)&&a.FileReader){var d=new FileReader;return d.onloadend=function(){var b=h?d.result:d.result.replace(/^data:[^;]*;/,"data:attachment/file;"),c=a.open(b,"_blank");c||(a.location.href=b),b=void 0,o.readyState=o.DONE,s()},d.readAsDataURL(b),void(o.readyState=o.INIT)}if(r||(r=c().createObjectURL(b)),q)a.location.href=r;else{var e=a.open(r,"_blank");e||(a.location.href=r)}o.readyState=o.DONE,s(),l(r)};return o.readyState=o.INIT,e?(r=c().createObjectURL(b),void setTimeout(function(){d.href=r,d.download=i,f(d),s(),l(r),o.readyState=o.DONE})):void t()},p=o.prototype,q=function(a,b,c){return new o(a,b||a.name||"download",c)};return"undefined"!=typeof navigator&&navigator.msSaveOrOpenBlob?function(a,b,c){return b=b||a.name||"download",c||(a=n(a)),navigator.msSaveOrOpenBlob(a,b)}:(p.abort=function(){},p.readyState=p.INIT=0,p.WRITING=1,p.DONE=2,p.error=p.onwritestart=p.onprogress=p.onwrite=p.onabort=p.onerror=p.onwriteend=null,q)}}("undefined"!=typeof self&&self||"undefined"!=typeof window&&window||this.content),"undefined"!=typeof module&&module.exports?module.exports.saveAs=saveAs:"undefined"!=typeof define&&null!==define&&null!==define.amd&&define([],function(){return saveAs}),function(a,b){"function"==typeof define&&define.amd?define([],b):"object"==typeof exports?module.exports=b():a.X2JS=b()}(this,function(){return function(a){function c(){void 0===a.escapeMode&&(a.escapeMode=!0),a.attributePrefix=a.attributePrefix||"_",a.arrayAccessForm=a.arrayAccessForm||"none",a.emptyNodeForm=a.emptyNodeForm||"text",void 0===a.enableToStringFunc&&(a.enableToStringFunc=!0),a.arrayAccessFormPaths=a.arrayAccessFormPaths||[],void 0===a.skipEmptyTextNodesForObj&&(a.skipEmptyTextNodesForObj=!0),void 0===a.stripWhitespaces&&(a.stripWhitespaces=!0),a.datetimeAccessFormPaths=a.datetimeAccessFormPaths||[],void 0===a.useDoubleQuotes&&(a.useDoubleQuotes=!1),a.xmlElementsFilter=a.xmlElementsFilter||[],a.jsonPropertiesFilter=a.jsonPropertiesFilter||[],void 0===a.keepCData&&(a.keepCData=!1)}function e(){}function f(a){var b=a.localName;return null==b&&(b=a.baseName),null!=b&&""!=b||(b=a.nodeName),b}function g(a){return a.prefix}function h(a){return"string"==typeof a?a.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&apos;"):a}function j(a,b,c,d){for(var e=0;e<a.length;e++){var f=a[e];if("string"==typeof f){if(f==d)break}else if(f instanceof RegExp){if(f.test(d))break}else if("function"==typeof f&&f(b,c,d))break}return e!=a.length}function k(b,c,d){switch(a.arrayAccessForm){case"property":b[c]instanceof Array?b[c+"_asArray"]=b[c]:b[c+"_asArray"]=[b[c]]}!(b[c]instanceof Array)&&a.arrayAccessFormPaths.length>0&&j(a.arrayAccessFormPaths,b,c,d)&&(b[c]=[b[c]])}function l(a){var b=a.split(/[-T:+Z]/g),c=new Date(b[0],b[1]-1,b[2]),d=b[5].split(".");if(c.setHours(b[3],b[4],d[0]),d.length>1&&c.setMilliseconds(d[1]),b[6]&&b[7]){var e=60*b[6]+Number(b[7]),f=/\d\d-\d\d:\d\d$/.test(a)?"-":"+";e=0+("-"==f?-1*e:e),c.setMinutes(c.getMinutes()-e-c.getTimezoneOffset())}else a.indexOf("Z",a.length-1)!==-1&&(c=new Date(Date.UTC(c.getFullYear(),c.getMonth(),c.getDate(),c.getHours(),c.getMinutes(),c.getSeconds(),c.getMilliseconds())));return c}function m(b,c,d){if(a.datetimeAccessFormPaths.length>0){var e=d.split(".#")[0];return j(a.datetimeAccessFormPaths,b,c,e)?l(b):b}return b}function n(b,c,e,f){return!(c==d.ELEMENT_NODE&&a.xmlElementsFilter.length>0)||j(a.xmlElementsFilter,b,e,f)}function o(b,c){if(b.nodeType==d.DOCUMENT_NODE){for(var e=new Object,h=b.childNodes,i=0;i<h.length;i++){var j=h.item(i);if(j.nodeType==d.ELEMENT_NODE){var l=f(j);e[l]=o(j,l)}}return e}if(b.nodeType==d.ELEMENT_NODE){var e=new Object;e.__cnt=0;for(var h=b.childNodes,i=0;i<h.length;i++){var j=h.item(i),l=f(j);if(j.nodeType!=d.COMMENT_NODE){var p=c+"."+l;n(e,j.nodeType,l,p)&&(e.__cnt++,null==e[l]?(e[l]=o(j,p),k(e,l,p)):(null!=e[l]&&(e[l]instanceof Array||(e[l]=[e[l]],k(e,l,p))),e[l][e[l].length]=o(j,p)))}}for(var q=0;q<b.attributes.length;q++){var r=b.attributes.item(q);e.__cnt++,e[a.attributePrefix+r.name]=r.value}var s=g(b);return null!=s&&""!=s&&(e.__cnt++,e.__prefix=s),null!=e["#text"]&&(e.__text=e["#text"],e.__text instanceof Array&&(e.__text=e.__text.join("\n")),a.stripWhitespaces&&(e.__text=e.__text.trim()),delete e["#text"],"property"==a.arrayAccessForm&&delete e["#text_asArray"],e.__text=m(e.__text,l,c+"."+l)),null!=e["#cdata-section"]&&(e.__cdata=e["#cdata-section"],delete e["#cdata-section"],"property"==a.arrayAccessForm&&delete e["#cdata-section_asArray"]),0==e.__cnt&&"text"==a.emptyNodeForm?e="":1==e.__cnt&&null!=e.__text?e=e.__text:1!=e.__cnt||null==e.__cdata||a.keepCData?e.__cnt>1&&null!=e.__text&&a.skipEmptyTextNodesForObj&&(a.stripWhitespaces&&""==e.__text||""==e.__text.trim())&&delete e.__text:e=e.__cdata,delete e.__cnt,!a.enableToStringFunc||null==e.__text&&null==e.__cdata||(e.toString=function(){return(null!=this.__text?this.__text:"")+(null!=this.__cdata?this.__cdata:"")}),e}if(b.nodeType==d.TEXT_NODE||b.nodeType==d.CDATA_SECTION_NODE)return b.nodeValue}function p(b,c,d,e){var f="<"+(null!=b&&null!=b.__prefix?b.__prefix+":":"")+c;if(null!=d)for(var g=0;g<d.length;g++){var i=d[g],j=b[i];a.escapeMode&&(j=h(j)),f+=" "+i.substr(a.attributePrefix.length)+"=",f+=a.useDoubleQuotes?'"'+j+'"':"'"+j+"'"}return f+=e?"/>":">"}function q(a,b){return"</"+(null!=a.__prefix?a.__prefix+":":"")+b+">"}function r(a,b){return a.indexOf(b,a.length-b.length)!==-1}function s(b,c){return!!("property"==a.arrayAccessForm&&r(c.toString(),"_asArray")||0==c.toString().indexOf(a.attributePrefix)||0==c.toString().indexOf("__")||b[c]instanceof Function)}function t(a){var b=0;if(a instanceof Object)for(var c in a)s(a,c)||b++;return b}function u(b,c,d){return 0==a.jsonPropertiesFilter.length||""==d||j(a.jsonPropertiesFilter,b,c,d)}function v(b){var c=[];if(b instanceof Object)for(var d in b)d.toString().indexOf("__")==-1&&0==d.toString().indexOf(a.attributePrefix)&&c.push(d);return c}function w(b){var c="";return null!=b.__cdata&&(c+="<![CDATA["+b.__cdata+"]]>"),null!=b.__text&&(c+=a.escapeMode?h(b.__text):b.__text),c}function x(b){var c="";return b instanceof Object?c+=w(b):null!=b&&(c+=a.escapeMode?h(b):b),c}function y(a,b){return""===a?b:a+"."+b}function z(a,b,c,d){var e="";if(0==a.length)e+=p(a,b,c,!0);else for(var f=0;f<a.length;f++)e+=p(a[f],b,v(a[f]),!1),e+=A(a[f],y(d,b)),e+=q(a[f],b);return e}function A(a,b){var c="",d=t(a);if(d>0)for(var e in a)if(!s(a,e)&&(""==b||u(a,e,y(b,e)))){var f=a[e],g=v(f);if(null==f||void 0==f)c+=p(f,e,g,!0);else if(f instanceof Object)if(f instanceof Array)c+=z(f,e,g,b);else if(f instanceof Date)c+=p(f,e,g,!1),c+=f.toISOString(),c+=q(f,e);else{var h=t(f);h>0||null!=f.__text||null!=f.__cdata?(c+=p(f,e,g,!1),c+=A(f,y(b,e)),c+=q(f,e)):c+=p(f,e,g,!0)}else c+=p(f,e,g,!1),c+=x(f),c+=q(f,e)}return c+=x(a)}var b="1.2.0";a=a||{},c(),e();var d={ELEMENT_NODE:1,TEXT_NODE:3,CDATA_SECTION_NODE:4,COMMENT_NODE:8,DOCUMENT_NODE:9};this.parseXmlString=function(a){var b=window.ActiveXObject||"ActiveXObject"in window;if(void 0===a)return null;var c;if(window.DOMParser){var d=new window.DOMParser,e=null;if(!b)try{e=d.parseFromString("INVALID","text/xml").getElementsByTagName("parsererror")[0].namespaceURI}catch(a){e=null}try{c=d.parseFromString(a,"text/xml"),null!=e&&c.getElementsByTagNameNS(e,"parsererror").length>0&&(c=null)}catch(a){c=null}}else 0==a.indexOf("<?")&&(a=a.substr(a.indexOf("?>")+2)),c=new ActiveXObject("Microsoft.XMLDOM"),c.async="false",c.loadXML(a);return c},this.asArray=function(a){return void 0===a||null==a?[]:a instanceof Array?a:[a]},this.toXmlDateTime=function(a){return a instanceof Date?a.toISOString():"number"==typeof a?new Date(a).toISOString():null},this.asDateTime=function(a){return"string"==typeof a?l(a):a},this.xml2json=function(a){return o(a)},this.xml_str2json=function(a){var b=this.parseXmlString(a);return null!=b?this.xml2json(b):null},this.json2xml_str=function(a){return A(a,"")},this.json2xml=function(a){var b=this.json2xml_str(a);return this.parseXmlString(b)},this.getVersion=function(){return b}}})}var saveAs;init(),process()}();